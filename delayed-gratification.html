<!DOCTYPE html>
<html>
    <head>
        <style>
body {
    margin: 0;            /* Reset default margin */
    background: rgb(65, 0, 65);
    color: rgb(255, 250, 245);
    font-family: Arial, Helvetica, sans-serif;
}
a {
    color: rgb(255, 250, 245);   
}
iframe {
    display: block;       /* iframes are inline by default */
    border: none;         /* Reset default border */
    height: 100vh;        /* Viewport-relative units */
    width: 100vw;
}
#redirect{
    text-align: center;
    padding: 5px;
}
</style>
    <script src="https://cdn.jsdelivr.net/npm/pouchdb@5.3.1/dist/pouchdb.min.js"></script>
    </head>
    <body>
        <h2 id="redirect"></h2>
        <iframe id="the_frame" src="https://en.m.wikipedia.org/wiki/Special:Random"></iframe>
        <div>
            <ul>
                <li>
                    <h2><a href="?s=https://twitter.com">Twitter</a></h2>
                </li>
                <li>
                    <h2><a href="?s=https://facebook.com">Facebook</a></h2>
                </li>
                <li>
                    <h2><a href="?s=https://reddit.com">Reddit</a></h2>
                </li>
                <form action="delayed-gratification.html" method="get">
                    <label for="name">URL:</label>
                    <input type="text" id="s" name="s">
                    <button type="submit">Go</button>
                </form>
            </ul>
        </div>
        <div>
            <ul id="stats"></ul>
        </div>
        <script>
            function getParameterByName(name, url) {
                    if (!url) url = window.location.href;
                    name = name.replace(/[\[\]]/g, "\\$&");
                    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                        results = regex.exec(url);
                    if (!results) return null;
                    if (!results[2]) return '';
                    return decodeURIComponent(results[2].replace(/\+/g, " "));
                }
            var site = getParameterByName("s");
            var frameList = window.frames;
            var db = new PouchDB('delayeddb');
            var ddoc = {
                _id: '_design/stats',
                views: {
                    by_site: {
                        map: function (doc) { emit(doc.site); }.toString(),
                        reduce: '_count'
                    }
                }
            };
            db.put(ddoc).then(function () {
                console.log('Created design doc');
            }).catch(function (err) {
                console.log('Error creating design doc');
            });
            db.info(function (err, info) {
                if (err) {
                    return console.log(err);
                } else {
                    console.log(info);
                }
            });
            if (site != null){    
                var time = 60 * 1000;
                db.post({site: site}, function (err, response) {
                    if (err) {
                        return console.log(err);
                    } else {
                        console.log("Document created Successfully");
                    }
                });
                setTimeout(function () {
                    window.location = site;
                }, time);
                setInterval(function () { 
                    var sitelink = "<a href='" + site + "'>" + site + "</a>"; 
                    document.getElementById("redirect").innerHTML = "You will be taken to " + sitelink + " in " + time / 1000 + " seconds."
                    time = time - 1000;
                }, 1000);
            } else {
                document.getElementById("redirect").remove();
                document.getElementById("the_frame").remove();
                db.query('stats/by_site', {group: true}).then(function (res) {
                    console.log(res);
                }).catch(function (err) {
                    console.log(err);
                });
            }
        </script>
    </body>
</html>
